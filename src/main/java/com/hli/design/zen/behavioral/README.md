# è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰

> ğŸ“– å¯¹åº”ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¦…ã€‹ç¬¬ä¸‰ç¯‡ï¼šè¡Œä¸ºå‹æ¨¡å¼

---

## ä¸€ã€æ¦‚è¿°

è¡Œä¸ºå‹æ¨¡å¼**å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡å’ŒèŒè´£åˆ†é…**ï¼Œæè¿°å¯¹è±¡å¦‚ä½•åä½œå®Œæˆå¤æ‚ä»»åŠ¡ã€‚

> **æ ¸å¿ƒæ€æƒ³**ï¼šå®šä¹‰å¯¹è±¡é—´çš„äº¤äº’æ–¹å¼ï¼Œä½¿å¾—ç³»ç»ŸèŒè´£åˆ†æ˜ã€æ˜“äºæ‰©å±•

---

## äºŒã€11ç§è¡Œä¸ºå‹æ¨¡å¼æ€»è§ˆ

| æ¨¡å¼ | æ ¸å¿ƒæ€æƒ³ | è§£å†³çš„é—®é¢˜ | é¢è¯•é¢‘ç‡ |
|------|----------|------------|----------|
| ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰ | å°è£…ç®—æ³•ï¼Œå¯äº’æ¢ | å¤šç§ç®—æ³•é€‰æ‹© | â˜…â˜…â˜…â˜…â˜… |
| è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰ | ä¸€å¯¹å¤šä¾èµ–é€šçŸ¥ | äº‹ä»¶é©±åŠ¨ã€è§£è€¦ | â˜…â˜…â˜…â˜…â˜… |
| è´£ä»»é“¾æ¨¡å¼ï¼ˆChainï¼‰ | é“¾å¼å¤„ç†è¯·æ±‚ | å¤šçº§å¤„ç†ã€è¿‡æ»¤å™¨ | â˜…â˜…â˜…â˜…â˜… |
| æ¨¡æ¿æ–¹æ³•ï¼ˆTemplateï¼‰ | å®šä¹‰ç®—æ³•éª¨æ¶ | æµç¨‹å¤ç”¨ | â˜…â˜…â˜…â˜…â˜† |
| çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰ | çŠ¶æ€é©±åŠ¨è¡Œä¸º | çŠ¶æ€æœº | â˜…â˜…â˜…â˜…â˜† |
| å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰ | å°è£…è¯·æ±‚ä¸ºå¯¹è±¡ | è¯·æ±‚é˜Ÿåˆ—ã€æ’¤é”€ | â˜…â˜…â˜…â˜†â˜† |
| ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰ | é›†ä¸­äº¤äº’æ§åˆ¶ | è§£è€¦å¤šå¯¹è±¡äº¤äº’ | â˜…â˜…â˜…â˜†â˜† |
| è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰ | é¡ºåºè®¿é—®å…ƒç´  | é›†åˆéå† | â˜…â˜…â˜…â˜†â˜† |
| å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰ | ä¿å­˜å’Œæ¢å¤çŠ¶æ€ | æ’¤é”€/æ¢å¤ | â˜…â˜…â˜†â˜†â˜† |
| è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰ | åˆ†ç¦»æ•°æ®å’Œæ“ä½œ | åŒåˆ†æ´¾ | â˜…â˜…â˜†â˜†â˜† |
| è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰ | å®šä¹‰è¯­æ³•è§£é‡Šå™¨ | DSLã€è§„åˆ™å¼•æ“ | â˜…â˜†â˜†â˜†â˜† |

---

## ä¸‰ã€æ¨¡å¼å¯¹æ¯”

### 3.1 é«˜é¢‘æ¨¡å¼å¯¹æ¯”

| å¯¹æ¯” | ç­–ç•¥æ¨¡å¼ | çŠ¶æ€æ¨¡å¼ | å‘½ä»¤æ¨¡å¼ |
|------|----------|----------|----------|
| å…³æ³¨ç‚¹ | ç®—æ³•é€‰æ‹© | çŠ¶æ€åˆ‡æ¢ | è¯·æ±‚å°è£… |
| è§¦å‘æ–¹å¼ | å®¢æˆ·ç«¯é€‰æ‹© | å†…éƒ¨çŠ¶æ€é©±åŠ¨ | è°ƒç”¨è€…è§¦å‘ |
| å…¸å‹åœºæ™¯ | æ”¯ä»˜æ–¹å¼ã€æ’åº | è®¢å•çŠ¶æ€æœº | ä»»åŠ¡é˜Ÿåˆ— |
| è°æ¥åˆ‡æ¢ | å®¢æˆ·ç«¯ | çŠ¶æ€ç±»è‡ªèº« | è°ƒç”¨è€… |

### 3.2 é€‰å‹å†³ç­–

```
éœ€è¦å¤šç§ç®—æ³•å¯åˆ‡æ¢ï¼Ÿ â”€â”€æ˜¯â”€â”€â–¶ ç­–ç•¥æ¨¡å¼
      â”‚
      å¦
      â”‚
      â–¼
éœ€è¦äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Ÿ â”€â”€æ˜¯â”€â”€â–¶ è§‚å¯Ÿè€…æ¨¡å¼
      â”‚
      å¦
      â”‚
      â–¼
éœ€è¦å¤šçº§å¤„ç†/è¿‡æ»¤ï¼Ÿ â”€â”€æ˜¯â”€â”€â–¶ è´£ä»»é“¾æ¨¡å¼
      â”‚
      å¦
      â”‚
      â–¼
éœ€è¦å®šä¹‰ç®—æ³•éª¨æ¶ï¼Ÿ â”€â”€æ˜¯â”€â”€â–¶ æ¨¡æ¿æ–¹æ³•æ¨¡å¼
      â”‚
      å¦
      â”‚
      â–¼
éœ€è¦çŠ¶æ€é©±åŠ¨è¡Œä¸ºï¼Ÿ â”€â”€æ˜¯â”€â”€â–¶ çŠ¶æ€æ¨¡å¼
      â”‚
      å¦
      â–¼
éœ€è¦è¯·æ±‚é˜Ÿåˆ—/æ’¤é”€ï¼Ÿ â”€â”€æ˜¯â”€â”€â–¶ å‘½ä»¤æ¨¡å¼
```

---

## å››ã€ç›®å½•ç»“æ„è§„åˆ’

```
behavioral/
â”œâ”€â”€ README.md               # æœ¬è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ strategy/               # ğŸ“‹ ç­–ç•¥æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ v1_bad/             # åä¾‹ï¼šif-elseåœ°ç‹±
â”‚   â””â”€â”€ v2_strategy/        # ç­–ç•¥æ¨¡å¼å®ç°
â”œâ”€â”€ observer/               # ğŸ“‹ è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ v1_push/            # æ¨æ¨¡å‹
â”‚   â””â”€â”€ v2_pull/            # æ‹‰æ¨¡å‹
â”œâ”€â”€ chain/                  # ğŸ“‹ è´£ä»»é“¾æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ v1_approval/        # å®¡æ‰¹æµç¨‹æ¡ˆä¾‹
â”œâ”€â”€ template/               # ğŸ“‹ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ state/                  # ğŸ“‹ çŠ¶æ€æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ v1_order_state/     # è®¢å•çŠ¶æ€æœº
â”œâ”€â”€ command/                # ğŸ“‹ å‘½ä»¤æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ mediator/               # ğŸ“‹ ä¸­ä»‹è€…æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ iterator/               # ğŸ“‹ è¿­ä»£å™¨æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ memento/                # ğŸ“‹ å¤‡å¿˜å½•æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ visitor/                # ğŸ“‹ è®¿é—®è€…æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
â””â”€â”€ interpreter/            # ğŸ“‹ è§£é‡Šå™¨æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
```

---

## äº”ã€é¢è¯•é«˜é¢‘é—®é¢˜

### Q1ï¼šç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ

| ç»´åº¦ | ç­–ç•¥æ¨¡å¼ | çŠ¶æ€æ¨¡å¼ |
|------|----------|----------|
| åˆ‡æ¢ä¸»ä½“ | å®¢æˆ·ç«¯ä¸»åŠ¨é€‰æ‹© | çŠ¶æ€ç±»å†…éƒ¨åˆ‡æ¢ |
| å…³æ³¨ç‚¹ | ç®—æ³•çš„å¯æ›¿æ¢æ€§ | çŠ¶æ€é©±åŠ¨çš„è¡Œä¸ºå˜åŒ– |
| å…¸å‹åœºæ™¯ | æ”¯ä»˜æ–¹å¼é€‰æ‹© | è®¢å•çŠ¶æ€æµè½¬ |
| ç­–ç•¥æ•°é‡ | ç­–ç•¥ä¹‹é—´ç‹¬ç«‹ | çŠ¶æ€ä¹‹é—´æœ‰å…³è” |

---

### Q2ï¼šè´£ä»»é“¾æ¨¡å¼æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ

**ä¼˜ç‚¹**ï¼š
- è§£è€¦è¯·æ±‚å’Œå¤„ç†è€…
- åŠ¨æ€è°ƒæ•´å¤„ç†é“¾
- ç¬¦åˆå¼€é—­åŸåˆ™

**ç¼ºç‚¹**ï¼š
- è¯·æ±‚å¯èƒ½åˆ°é“¾å°¾éƒ½æœªè¢«å¤„ç†
- è°ƒè¯•å›°éš¾ï¼Œä¸å®¹æ˜“è§‚å¯Ÿé“¾è·¯

**åº”ç”¨**ï¼šServlet Filterã€Spring Interceptorã€Netty Pipeline

---

### Q3ï¼šè§‚å¯Ÿè€…æ¨¡å¼çš„æ¨æ¨¡å‹å’Œæ‹‰æ¨¡å‹ï¼Ÿ

| æ¨¡å‹ | è¯´æ˜ | ä¼˜ç¼ºç‚¹ |
|------|------|--------|
| æ¨æ¨¡å‹ | ä¸»é¢˜æ¨é€è¯¦ç»†æ•°æ® | ç®€å•ï¼Œä½†ä¸çµæ´» |
| æ‹‰æ¨¡å‹ | ä¸»é¢˜åªé€šçŸ¥ï¼Œè§‚å¯Ÿè€…ä¸»åŠ¨æ‹‰å– | çµæ´»ï¼Œä½†ç¨å¤æ‚ |

**Spring äº‹ä»¶æœºåˆ¶**é‡‡ç”¨æ¨æ¨¡å‹ï¼š`ApplicationEvent` æºå¸¦æ•°æ®

---

### Q4ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ

**é’©å­æ–¹æ³•**ï¼šçˆ¶ç±»ä¸­æœ‰é»˜è®¤å®ç°ï¼ˆé€šå¸¸ä¸ºç©ºï¼‰ï¼Œå­ç±»å¯é€‰æ‹©æ€§è¦†ç›–

```java
public abstract class AbstractTemplate {
    public final void templateMethod() {
        step1();
        if (hook()) {   // é’©å­æ–¹æ³•
            step2();
        }
        step3();
    }
    
    // é’©å­æ–¹æ³•ï¼Œå­ç±»å¯é€‰è¦†ç›–
    protected boolean hook() {
        return true;
    }
}
```

---

## å…­ã€å®é™…é¡¹ç›®åº”ç”¨

### 6.1 JDK æºç 

| æ¨¡å¼ | ç¤ºä¾‹ |
|------|------|
| ç­–ç•¥ | `Comparator`ï¼ˆæ’åºç­–ç•¥ï¼‰ |
| è§‚å¯Ÿè€… | `java.util.Observer`ï¼ˆå·²åºŸå¼ƒï¼‰ |
| è¿­ä»£å™¨ | `Iterator` æ¥å£ |
| æ¨¡æ¿æ–¹æ³• | `AbstractList.add()` |
| å‘½ä»¤ | `Runnable` æ¥å£ |

### 6.2 Spring æºç 

| æ¨¡å¼ | ç¤ºä¾‹ |
|------|------|
| ç­–ç•¥ | `Resource`ï¼ˆç±»è·¯å¾„/URL/æ–‡ä»¶ç­–ç•¥ï¼‰ |
| è§‚å¯Ÿè€… | `ApplicationEvent` + `ApplicationListener` |
| è´£ä»»é“¾ | `HandlerInterceptor` æ‹¦æˆªå™¨é“¾ |
| æ¨¡æ¿æ–¹æ³• | `JdbcTemplate`ã€`RestTemplate` |
| çŠ¶æ€ | çŠ¶æ€æœºæ¡†æ¶ `spring-statemachine` |

### 6.3 å¤§å‚åº”ç”¨åœºæ™¯

| æ¨¡å¼ | åœºæ™¯ |
|------|------|
| ç­–ç•¥ | æ”¯ä»˜æ–¹å¼ã€ä¿ƒé”€è§„åˆ™ã€é™æµç®—æ³• |
| è§‚å¯Ÿè€… | æ¶ˆæ¯é€šçŸ¥ã€äº‹ä»¶æ€»çº¿ã€å‘å¸ƒè®¢é˜… |
| è´£ä»»é“¾ | å®¡æ‰¹æµç¨‹ã€æƒé™æ ¡éªŒã€è¿‡æ»¤å™¨é“¾ |
| æ¨¡æ¿æ–¹æ³• | æ•°æ®å¯¼å…¥å¯¼å‡ºã€æŠ¥è¡¨ç”Ÿæˆ |
| çŠ¶æ€ | è®¢å•çŠ¶æ€æœºã€å·¥ä½œæµå¼•æ“ |
| å‘½ä»¤ | ä»»åŠ¡è°ƒåº¦ã€æ“ä½œæ—¥å¿—ã€æ’¤é”€é‡åš |

---

## ä¸ƒã€æ ¸å¿ƒä»£ç ç¤ºä¾‹

### 7.1 ç­–ç•¥æ¨¡å¼ï¼ˆé¢è¯•å¿…å†™ï¼‰

```java
// ç­–ç•¥æ¥å£
public interface PaymentStrategy {
    void pay(BigDecimal amount);
}

// å…·ä½“ç­–ç•¥
public class AlipayStrategy implements PaymentStrategy {
    @Override
    public void pay(BigDecimal amount) {
        log.info("æ”¯ä»˜å®æ”¯ä»˜|Alipay_payment,amount={}", amount);
    }
}

// ä¸Šä¸‹æ–‡
public class PaymentContext {
    private PaymentStrategy strategy;
    
    public void setStrategy(PaymentStrategy strategy) {
        this.strategy = strategy;
    }
    
    public void executePayment(BigDecimal amount) {
        strategy.pay(amount);
    }
}
```

### 7.2 è´£ä»»é“¾æ¨¡å¼

```java
public abstract class Handler {
    protected Handler next;
    
    public void setNext(Handler next) {
        this.next = next;
    }
    
    public abstract void handle(Request request);
    
    protected void handleNext(Request request) {
        if (next != null) {
            next.handle(request);
        }
    }
}
```

### 7.3 è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆSpring ç‰ˆï¼‰

```java
// å®šä¹‰äº‹ä»¶
public class OrderCreatedEvent extends ApplicationEvent {
    private Order order;
    // ...
}

// å®šä¹‰ç›‘å¬å™¨
@Component
public class OrderEventListener {
    @EventListener
    public void onOrderCreated(OrderCreatedEvent event) {
        log.info("æ”¶åˆ°è®¢å•åˆ›å»ºäº‹ä»¶|Order_event_received,orderId={}", 
                event.getOrder().getId());
    }
}

// å‘å¸ƒäº‹ä»¶
@Autowired
private ApplicationEventPublisher publisher;

public void createOrder(Order order) {
    // ä¿å­˜è®¢å•...
    publisher.publishEvent(new OrderCreatedEvent(order));
}
```

---

## å…«ã€å­¦ä¹ è·¯çº¿å»ºè®®

```
1. ç­–ç•¥æ¨¡å¼ï¼ˆæ¶ˆé™¤ if-elseï¼‰
        â†“
2. è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆSpring Eventï¼‰
        â†“
3. è´£ä»»é“¾æ¨¡å¼ï¼ˆFilter é“¾ï¼‰
        â†“
4. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆä»£ç å¤ç”¨ï¼‰
        â†“
5. çŠ¶æ€æ¨¡å¼ï¼ˆçŠ¶æ€æœºï¼‰
        â†“
6. å…¶ä»–æ¨¡å¼ï¼ˆæŒ‰éœ€å­¦ä¹ ï¼‰
```

---

## ä¹ã€é¢è¯•æ·±æŒ–è¿½é—®

1. **å¦‚ä½•ç”¨ Spring å®ç°ç­–ç•¥æ¨¡å¼ï¼Ÿ**
   ```java
   @Autowired
   private Map<String, PaymentStrategy> strategyMap;
   
   public void pay(String type, BigDecimal amount) {
       strategyMap.get(type).pay(amount);
   }
   ```

2. **è´£ä»»é“¾å’Œè£…é¥°å™¨çš„åŒºåˆ«ï¼Ÿ**
   - è´£ä»»é“¾ï¼šè¯·æ±‚æ²¿é“¾ä¼ é€’ï¼Œå¯èƒ½è¢«ä»»ä¸€èŠ‚ç‚¹å¤„ç†
   - è£…é¥°å™¨ï¼šå±‚å±‚åŒ…è£…ï¼Œæ¯å±‚éƒ½ä¼šæ‰§è¡Œ

3. **è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…çš„åŒºåˆ«ï¼Ÿ**
   - è§‚å¯Ÿè€…ï¼šè§‚å¯Ÿè€…ç›´æ¥è®¢é˜…ä¸»é¢˜
   - å‘å¸ƒè®¢é˜…ï¼šæœ‰ä¸­é—´çš„æ¶ˆæ¯ä»£ç†ï¼ˆå¦‚ Kafkaï¼‰

4. **çŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼èƒ½ç»“åˆä½¿ç”¨å—ï¼Ÿ**
   - å¯ä»¥ã€‚çŠ¶æ€æ¨¡å¼ç®¡ç†çŠ¶æ€åˆ‡æ¢ï¼Œæ¯ä¸ªçŠ¶æ€å†…éƒ¨ä½¿ç”¨ç­–ç•¥æ¨¡å¼é€‰æ‹©å…·ä½“è¡Œä¸ºã€‚

---

> ğŸ“Œ **å­¦ä¹ å»ºè®®**ï¼šç­–ç•¥ã€è§‚å¯Ÿè€…ã€è´£ä»»é“¾æ˜¯é¢è¯•å¿…é—®ï¼ŒåŠ¡å¿…èƒ½æ‰‹å†™ä»£ç å’Œè¯´å‡º Spring ä¸­çš„åº”ç”¨ã€‚
